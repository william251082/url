<h1>Assessment</h1>

<nav>
    <div id="register">
        <label for="email">Email:</label>
        <input type="email" id="email" placeholder="Enter email" name="email">
        <label for="password">Password:</label>
        <input type="password" id="password" placeholder="Enter password" name="password">
        <button onclick="register()">Register</button>
    </div>
    <div id="welcome"></div>
</nav>
<br><br><br><br>
<div>
    <label for="long_url">Please enter your long url: </label>
    <input type="text" id="long_url" style="width: 700px;">
    <br><br>
    <button onclick="submitUrl()">Convert to a shorter url</button>
    <br><br>
    <div id="link"></div>
</div>

<script>
    const submitUrl = async () => {
      const inputValue = document.getElementById('long_url').value
      if (!inputValue) {
        alert( "Please provide a url!" );
      }
      const data = {long_name: inputValue}
      const options = {
        method: 'POST',
        headers: new Headers({'content-type': 'application/json'}),
        redirect: 'manual',
        body: JSON.stringify(data)
      };
      try {
        const rawResponse = await fetch('http://localhost:8080/api/url', options)
        if (rawResponse.redirected) {
          window.location.href = rawResponse.url
        }
        const jsonResponse = await rawResponse.json()
        const shortName = jsonResponse['short_name']
        const longName = jsonResponse['long_name']
        const html = `
            <a href="${longName}">
                ${shortName}
            </a>
        `
        const link = document.getElementById('link')
        link.innerHTML = html
      } catch (error) {
        console.error('Error:', error);
      }
    }

    const register = async () => {
      const email = document.getElementById('email').value
      const password = document.getElementById('password').value
      if (!email) {
        alert( "Please enter an email!" );
      }
      if (!password) {
        alert( "Please enter a password!" );
      }
      const data = {email, password}
      const options = {
        method: 'POST',
        headers: new Headers({'content-type': 'application/json'}),
        body: JSON.stringify(data)
      };
      try {
        const rawResponse = await fetch('http://localhost:8080/api/register', options)
        const jsonResponse = await rawResponse.json()
        const registerElement = document.getElementById("register")
        if (jsonResponse.message === 'CREATED') {
          registerElement.style.display = 'none'
          const html = `
            <div>Welcome ${jsonResponse['user']['email']}!!!</div>
          `
          const welcome = document.getElementById('welcome')
          welcome.innerHTML = html
        }
      } catch (error) {
        console.error('Error:', error);
      }
    }
</script>
